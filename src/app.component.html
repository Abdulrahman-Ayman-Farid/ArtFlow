<!-- Navigation (Hidden on Welcome Screen) -->
@if (currentView() !== 'welcome') {
<nav class="sticky top-0 z-50 bg-slate-950/80 backdrop-blur-xl border-b border-red-500/10 transition-all duration-300 shadow-lg shadow-red-900/10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 gap-4">
      
      <!-- Logo & Desktop Menu -->
      <div class="flex items-center gap-8">
        <div class="flex-shrink-0 flex items-center cursor-pointer" (click)="setView('welcome')">
          <div class="w-8 h-8 bg-red-600 rounded-lg flex items-center justify-center mr-3 shadow-lg shadow-red-500/20 transform hover:rotate-12 transition-transform">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
            </svg>
          </div>
          <span class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 hidden sm:block">ArtFlow</span>
        </div>

        <div class="hidden md:flex items-baseline space-x-4">
          <button 
            (click)="setView('home')"
            [class.bg-red-500/20]="currentView() === 'home'"
            [class.text-red-400]="currentView() === 'home'"
            class="text-slate-300 hover:bg-white/5 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors"
          >
            Gallery
          </button>
          
          <button 
            (click)="setView('favorites')"
            [class.bg-red-500/20]="currentView() === 'favorites'"
            [class.text-red-400]="currentView() === 'favorites'"
            class="text-slate-300 hover:bg-white/5 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2"
          >
            <span>Favorites</span>
            @if (store.favoritesCount() > 0) {
              <span class="bg-yellow-500 text-slate-900 font-bold text-xs px-2 py-0.5 rounded-full">{{ store.favoritesCount() }}</span>
            }
          </button>
        </div>
      </div>

      <!-- Search Bar (Centered/Flexible) -->
      @if (currentView() === 'home') {
        <div class="flex-1 flex justify-center max-w-md mx-4">
          <app-search-bar></app-search-bar>
        </div>
      } @else {
        <div class="flex-1"></div>
      }

      <!-- Right Actions -->
      <div class="flex items-center gap-3">
        <!-- Add Art Button -->
        <button 
          (click)="setView('upload')"
          class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-red-900/30 transition-all flex items-center gap-2 hidden sm:flex border border-red-500/20"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          <span>Add Art</span>
        </button>
        <!-- Mobile Add Button -->
        <button 
          (click)="setView('upload')"
          class="sm:hidden bg-red-600 hover:bg-red-500 text-white p-2 rounded-lg shadow-lg shadow-red-900/30"
        >
           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
        </button>

        <!-- Auth Section -->
        @if (store.isLoggedIn()) {
          <!-- User Menu -->
          <div class="relative">
            <button 
              (click)="toggleProfile()"
              [class.ring-2]="showProfile()"
              class="ring-red-500 ring-offset-2 ring-offset-slate-900 rounded-full transition-all flex items-center"
            >
              <div class="w-9 h-9 rounded-full overflow-hidden bg-slate-800 border border-slate-700">
                <img [src]="store.userProfile().avatarUrl" alt="Profile" class="w-full h-full object-cover">
              </div>
            </button>
          </div>
        } @else {
          <!-- Login Buttons -->
          <div class="flex gap-2">
             <button 
               (click)="setView('login')"
               class="text-slate-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors hidden sm:block"
             >
               Log In
             </button>
             <button 
               (click)="setView('signup')"
               class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-sm font-medium border border-white/10 transition-all backdrop-blur-sm"
             >
               Sign Up
             </button>
          </div>
        }
      </div>
    </div>
  </div>
</nav>
}

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-[calc(100vh-4rem)]">
  
  <!-- Welcome View -->
  @if (currentView() === 'welcome') {
    <app-welcome-view 
      (onEnter)="setView('home')" 
      (onJoin)="setView('signup')"
    ></app-welcome-view>
  }

  <!-- Home View -->
  @if (currentView() === 'home') {
    <div class="space-y-6 animate-in fade-in duration-500">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-white tracking-tight">Community Feed</h1>
          <div class="text-sm text-slate-400">Discover inspiring works</div>
        </div>
        @if (store.searchQuery()) {
          <div class="text-orange-400 text-sm font-medium bg-orange-500/10 px-3 py-1 rounded-full border border-orange-500/20">
            Results for "{{ store.searchQuery() }}"
          </div>
        }
      </div>
      
      @if (store.artworks().length === 0) {
        <div class="text-center py-20">
          <p class="text-slate-500 text-lg">No artworks found matching your search.</p>
          <button (click)="store.setSearchQuery('')" class="text-orange-400 hover:underline mt-2">Clear search</button>
        </div>
      } @else {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          @for (item of store.artworks(); track item.id; let idx = $index) {
            <app-art-card 
              [id]="item.id"
              [art]="item"
              [priority]="idx < 6"
              (onToggleLike)="onToggleLike($event)"
              (onToggleFavorite)="onToggleFavorite($event)"
            ></app-art-card>
          }
        </div>
      }
    </div>
  }

  <!-- Favorites View -->
  @if (currentView() === 'favorites') {
    <div class="space-y-6 animate-in fade-in duration-500">
      <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-white">Your Favorites</h1>
        <button (click)="setView('home')" class="text-sm text-red-400 hover:text-red-300">Back to Gallery</button>
      </div>

      @if (store.favorites().length === 0) {
        <div class="text-center py-20 bg-slate-800/40 backdrop-blur-sm rounded-xl border border-dashed border-slate-700">
          <div class="w-16 h-16 bg-slate-800/50 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
            </svg>
          </div>
          <h3 class="text-lg font-medium text-white mb-2">No favorites yet</h3>
          <p class="text-slate-400 mb-6">Start exploring and save the art you love.</p>
          <button (click)="setView('home')" class="text-red-400 hover:underline">Browse Gallery</button>
        </div>
      } @else {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          @for (item of store.favorites(); track item.id; let idx = $index) {
            <app-art-card 
              [id]="item.id"
              [art]="item"
              [priority]="idx < 6"
              (onToggleLike)="onToggleLike($event)"
              (onToggleFavorite)="onToggleFavorite($event)"
            ></app-art-card>
          }
        </div>
      }
    </div>
  }

  <!-- Upload View -->
  @if (currentView() === 'upload') {
    <app-upload-view 
      (onCancel)="setView('home')"
      (onSuccess)="setView('home')"
    ></app-upload-view>
  }

  <!-- Auth Views -->
  @if (currentView() === 'login') {
    <app-login-view 
      (onSuccess)="setView('home')"
      (onGoToSignup)="setView('signup')"
    ></app-login-view>
  }

  @if (currentView() === 'signup') {
    <app-signup-view 
      (onSuccess)="setView('home')"
      (onGoToLogin)="setView('login')"
    ></app-signup-view>
  }
</main>

<!-- Profile Modal Overlay -->
@if (showProfile()) {
  <app-profile-view
    (onClose)="showProfile.set(false)"
    (onSave)="showProfile.set(false)"
  >
    <!-- Inject Logout Button into Profile View -->
    <div class="border-t border-slate-700 pt-4 mt-4" ngProjectAs="footer-actions">
      <button 
        (click)="onLogout()"
        class="w-full text-center text-red-400 hover:text-red-300 text-sm font-medium py-2 rounded hover:bg-red-500/10 transition-colors"
      >
        Sign Out
      </button>
    </div>
  </app-profile-view>
}